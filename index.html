<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="FrançaisIA - Plateforme d'apprentissage adaptatif">
    <title>FrançaisIA - Plateforme d'Apprentissage</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { 
            --primary: #2563eb;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f1f5f9;
        }
        body { 
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            padding: 15px; 
        }
        .container { max-width: 1400px; margin: 0 auto; }

        /* Header Moderne */
        header { 
            background: white; 
            border-radius: 20px; 
            padding: 25px 30px; 
            margin-bottom: 25px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-wrap: wrap; 
            gap: 20px; 
        }

        /* Logo Professionnel */
        .logo { display: flex; align-items: center; gap: 20px; }
        .logo-container {
            position: relative;
            width: 70px;
            height: 70px;
        }
        .logo-circle {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
            position: relative;
            overflow: hidden;
        }
        .logo-circle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3), transparent 70%);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        .logo-text-main {
            font-size: 2.8em;
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .logo-info h1 { 
            font-size: clamp(1.6em, 4vw, 2.2em); 
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            letter-spacing: -0.5px;
        }
        .logo-info p { 
            color: #64748b; 
            font-size: clamp(0.85em, 2vw, 1em);
            font-weight: 500;
            margin-top: 5px;
        }

        /* Boutons Header */
        .header-actions { display: flex; gap: 12px; flex-wrap: wrap; }
        .header-btn { 
            padding: 12px 24px; 
            border-radius: 12px; 
            border: none; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 0.95em;
            color: white; 
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .btn-help { background: linear-gradient(135deg, #2563eb, #3b82f6); }
        .btn-export { background: linear-gradient(135deg, #10b981, #34d399); }
        .btn-reset { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .header-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
        .header-btn:active { transform: translateY(0); }

        /* Dashboard Cards */
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
            gap: 20px; 
            margin-bottom: 25px; 
        }
        .stat-card { 
            background: white; 
            border-radius: 16px; 
            padding: 25px; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            display: flex; 
            align-items: center; 
            gap: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .stat-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }
        .stat-icon { 
            width: 65px; 
            height: 65px; 
            border-radius: 14px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 2em;
            flex-shrink: 0;
        }
        .stat-icon.primary { background: linear-gradient(135deg, #2563eb, #3b82f6); }
        .stat-icon.success { background: linear-gradient(135deg, #10b981, #34d399); }
        .stat-icon.warning { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .stat-icon.info { background: linear-gradient(135deg, #06b6d4, #22d3ee); }
        .stat-content h3 { font-size: 2.2em; color: var(--dark); margin-bottom: 5px; }
        .stat-content p { color: #64748b; font-size: 0.95em; font-weight: 500; }

        /* Level Card */
        .level-card { 
            background: white; 
            border-radius: 16px; 
            padding: 28px; 
            margin-bottom: 25px; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        .level-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .level-header h2 { color: var(--dark); font-size: 1.4em; }
        .level-badge { 
            padding: 10px 22px; 
            border-radius: 12px; 
            font-weight: 700;
            font-size: 0.95em;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .level-badge.debutant { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .level-badge.intermediaire { background: linear-gradient(135deg, #06b6d4, #22d3ee); }
        .level-badge.avance { background: linear-gradient(135deg, #10b981, #34d399); }
        .progress-bar-container { 
            background: #e2e8f0; 
            border-radius: 12px; 
            height: 32px; 
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            transition: width 1s ease;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-weight: 700;
            font-size: 0.9em;
        }

        /* Recommendations Section - Simplifié */
        .recommendations { 
            background: white;
            border-radius: 16px; 
            padding: 28px; 
            margin-bottom: 25px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        .recommendations h2 {
            color: var(--dark);
            font-size: 1.4em;
            margin-bottom: 15px;
        }
        .recommendation-item { 
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 20px; 
            border-radius: 12px;
            border-left: 4px solid #2563eb;
            margin-top: 12px;
        }
        .recommendation-item strong { 
            color: #1e40af;
            font-size: 1.05em;
        }
        .recommendation-item p {
            color: #475569;
            line-height: 1.6;
            margin-top: 5px;
        }

        /* Lessons Section */
        .lessons-section { 
            background: white; 
            border-radius: 16px; 
            padding: 28px; 
            margin-bottom: 25px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        .lessons-section h2 { 
            color: var(--dark); 
            font-size: 1.6em;
            margin-bottom: 20px;
        }
        .filter-buttons { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .filter-btn { 
            padding: 10px 20px; 
            border: 2px solid #e2e8f0;
            background: white; 
            color: #64748b;
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        .filter-btn.active { 
            background: #2563eb;
            color: white;
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .filter-btn:hover { border-color: #2563eb; color: #2563eb; }

        .lessons-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px;
        }
        .lesson-card { 
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px; 
            padding: 28px; 
            cursor: pointer; 
            transition: all 0.3s;
            border: 2px solid #e2e8f0;
        }
        .lesson-card:hover { 
            transform: translateY(-6px); 
            box-shadow: 0 16px 40px rgba(0,0,0,0.12);
            border-color: #2563eb;
        }
        .lesson-icon { font-size: 3.5em; margin-bottom: 15px; }
        .lesson-title { 
            font-size: 1.5em; 
            color: var(--dark); 
            margin-bottom: 10px; 
            font-weight: 700;
        }
        .lesson-description { 
            color: #64748b; 
            font-size: 0.95em; 
            margin-bottom: 18px; 
            line-height: 1.6;
        }
        .lesson-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 18px;
            border-top: 2px solid #e2e8f0;
        }
        .lesson-difficulty { 
            padding: 6px 16px; 
            border-radius: 8px; 
            font-size: 0.85em; 
            font-weight: 700;
        }
        .difficulty-facile { background: #d1fae5; color: #065f46; }
        .difficulty-moyen { background: #fef3c7; color: #92400e; }
        .difficulty-difficile { background: #fee2e2; color: #991b1b; }

        /* Lesson Container */
        .lesson-container { display: none; background: white; border-radius: 16px; padding: 28px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
        .lesson-container.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .lesson-nav { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
            padding-bottom: 20px; 
            border-bottom: 2px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 15px;
        }
        .back-btn { 
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: white; 
            border: none; 
            padding: 14px 32px; 
            border-radius: 12px; 
            font-size: 1.05em; 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .back-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4); }

        /* Question Card */
        .question-card { 
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px; 
            padding: 32px; 
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }
        .question-header { 
            display: flex; 
            align-items: center; 
            gap: 18px; 
            margin-bottom: 28px;
            flex-wrap: wrap;
        }
        .question-number { 
            width: 55px; 
            height: 55px; 
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 1.4em; 
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .question-text h3 { 
            font-size: 1.4em; 
            color: var(--dark); 
            line-height: 1.5;
            font-weight: 600;
        }

        .options-grid { display: grid; gap: 14px; }
        .option { 
            background: white; 
            padding: 18px 24px; 
            border-radius: 12px; 
            border: 2px solid #e2e8f0;
            cursor: pointer; 
            transition: all 0.3s;
            font-size: 1.05em;
            color: var(--dark);
        }
        .option:hover { 
            border-color: #2563eb;
            background: #eff6ff;
            transform: translateX(4px);
        }
        .option.correct { 
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: #10b981;
            font-weight: 600;
        }
        .option.wrong { 
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border-color: #ef4444;
        }

        .explanation-box { 
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-left: 4px solid #2563eb;
            padding: 22px; 
            border-radius: 12px; 
            margin-top: 20px; 
            display: none;
        }
        .explanation-box.show { display: block; animation: slideDown 0.4s; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }
        .explanation-box h4 { color: #1e40af; margin-bottom: 10px; font-size: 1.15em; }
        .explanation-box p { color: #475569; line-height: 1.7; }

        .btn { 
            padding: 16px 40px; 
            border: none; 
            border-radius: 12px; 
            font-size: 1.1em; 
            font-weight: 600;
            cursor: pointer; 
            color: white; 
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4); }

        .performance-report { display: none; text-align: center; padding: 40px; }
        .performance-report.show { display: block; }
        .performance-report h2 { font-size: 3.5em; margin-bottom: 20px; }
        .performance-report h3 { color: var(--dark); font-size: 1.8em; margin-bottom: 30px; }

        /* Modal */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.75);
            z-index: 1000; 
            padding: 20px; 
            overflow-y: auto;
        }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { 
            background: white; 
            border-radius: 20px; 
            padding: 35px; 
            max-width: 800px; 
            width: 100%; 
            max-height: 90vh; 
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
        }
        .close-modal { 
            width: 42px; 
            height: 42px; 
            border-radius: 50%; 
            background: #ef4444;
            border: none; 
            cursor: pointer; 
            font-size: 1.5em; 
            color: white;
            float: right;
            transition: all 0.3s;
        }
        .close-modal:hover { transform: rotate(90deg); background: #dc2626; }
        .modal-content h2 { color: #2563eb; font-size: 2em; margin: 20px 0; }
        .modal-content p { color: #475569; line-height: 1.8; margin-bottom: 15px; }

        @media (max-width: 768px) { 
            header { flex-direction: column; }
            .lessons-grid { grid-template-columns: 1fr; }
            .dashboard { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-container">
                    <div class="logo-circle">
                        <span class="logo-text-main">F</span>
                    </div>
                </div>
                <div class="logo-info">
                    <h1>FrançaisIA</h1>
                    <p>Plateforme d'Apprentissage Adaptatif</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn btn-help" onclick="showHelp()">📖 Guide</button>
                <button class="header-btn btn-export" onclick="exportData()">💾 Exporter</button>
                <button class="header-btn btn-reset" onclick="resetData()">🔄 Reset</button>
            </div>
        </header>

        <div class="modal" id="helpModal">
            <div class="modal-content">
                <button class="close-modal" onclick="closeHelp()">×</button>
                <h2>📖 Guide d'Utilisation</h2>
                <p><strong>FrançaisIA</strong> est une plateforme d'apprentissage adaptatif de la grammaire française développée dans le cadre d'un projet de Master en Sciences du Langage à l'Université de Mostaganem.</p>
                <p><strong>150 questions</strong> réparties sur <strong>10 modules</strong> avec suivi personnalisé de votre progression et analyse détaillée de vos performances.</p>
                <h3 style="color: #2563eb; margin-top: 25px;">🎯 Comment utiliser</h3>
                <p>1. Choisissez un module selon votre niveau<br>2. Répondez aux 15 questions<br>3. Consultez vos résultats et recommandations<br>4. Suivez votre progression dans le tableau de bord</p>
            </div>
        </div>

        <div id="mainDashboard">
            <div class="dashboard">
                <div class="stat-card">
                    <div class="stat-icon primary">📊</div>
                    <div class="stat-content">
                        <h3 id="totalQuestions">0</h3>
                        <p>Questions traitées</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon success">✅</div>
                    <div class="stat-content">
                        <h3 id="correctAnswers">0</h3>
                        <p>Réponses correctes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon warning">🎯</div>
                    <div class="stat-content">
                        <h3 id="accuracyRate">0%</h3>
                        <p>Taux de réussite</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon info">⚡</div>
                    <div class="stat-content">
                        <h3 id="streak">0</h3>
                        <p>Série actuelle</p>
                    </div>
                </div>
            </div>

            <div class="level-card">
                <div class="level-header">
                    <h2>📈 Progression de Compétence</h2>
                    <div class="level-badge debutant" id="levelBadge">Débutant</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="levelProgress" style="width: 0%">0%</div>
                </div>
            </div>

            <div class="recommendations">
                <h2>💡 Recommandations Personnalisées</h2>
                <div id="aiSuggestions">
                    <div class="recommendation-item">
                        <strong>🎯 Commencez votre parcours</strong>
                        <p>Sélectionnez un module ci-dessous pour débuter votre apprentissage. Nous vous recommandons de commencer par <strong>Les Noms</strong> pour construire une base solide.</p>
                    </div>
                </div>
            </div>

            <div class="lessons-section">
                <h2>📚 Modules d'Apprentissage (150 Questions)</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterLessons('tous')">Tous</button>
                    <button class="filter-btn" onclick="filterLessons('facile')">Facile</button>
                    <button class="filter-btn" onclick="filterLessons('moyen')">Moyen</button>
                    <button class="filter-btn" onclick="filterLessons('difficile')">Difficile</button>
                </div>
                <div class="lessons-grid" id="lessonsGrid"></div>
            </div>
        </div>

        <div class="lesson-container" id="lessonContainer">
            <div class="lesson-nav">
                <button class="back-btn" onclick="exitLesson()">← Retour au tableau de bord</button>
                <div>
                    <h3 id="currentLessonTitle" style="color: var(--dark); font-size: 1.5em;"></h3>
                    <p id="lessonProgressText" style="color: #64748b; margin-top: 5px;"></p>
                </div>
            </div>
            <div id="questionArea"></div>
            <button class="btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">Question suivante →</button>
            <div class="performance-report" id="performanceReport"></div>
        </div>
    </div>

    <script>
        const lessons = [
            {id: 'noms', title: 'Les Noms', icon: '📦', desc: 'Identification et classification des noms', difficulty: 'facile'},
            {id: 'verbes', title: 'Les Verbes', icon: '🏃', desc: 'Reconnaissance et utilisation des verbes', difficulty: 'moyen'},
            {id: 'adjectifs', title: 'Les Adjectifs', icon: '🎨', desc: 'Accord des adjectifs en genre et nombre', difficulty: 'moyen'},
            {id: 'determinants', title: 'Les Déterminants', icon: '🔤', desc: 'Usage des articles et déterminants', difficulty: 'difficile'},
            {id: 'prepositions', title: 'Les Prépositions', icon: '➡️', desc: 'Prépositions de lieu et de temps', difficulty: 'difficile'},
            {id: 'pronoms', title: 'Les Pronoms', icon: '👥', desc: 'Utilisation correcte des pronoms', difficulty: 'moyen'},
            {id: 'conjugaison', title: 'La Conjugaison', icon: '🔄', desc: 'Conjugaison aux temps principaux', difficulty: 'difficile'},
            {id: 'phrases', title: 'Structure de Phrase', icon: '✏️', desc: 'Construction de phrases correctes', difficulty: 'moyen'},
            {id: 'orthographe', title: 'L\'Orthographe', icon: '📝', desc: 'Correction des erreurs courantes', difficulty: 'difficile'},
            {id: 'temps', title: 'Les Temps Verbaux', icon: '⏰', desc: 'Distinction et usage des temps', difficulty: 'facile'}
        ];

        const questions = {
            noms: [
                {q: "Dans 'Le chat noir dort', quel est le nom ?", opts: ["Le", "chat", "noir", "dort"], c: 1, exp: "'Chat' est un nom commun désignant un animal."},
                {q: "Quel mot est un nom propre ?", opts: ["ville", "Paris", "maison", "rue"], c: 1, exp: "'Paris' est un nom propre avec majuscule."},
                {q: "Combien de noms dans 'Marie joue au ballon' ?", opts: ["1", "2", "3", "0"], c: 1, exp: "Deux noms : 'Marie' et 'ballon'."},
                {q: "Quel nom désigne une idée abstraite ?", opts: ["table", "bonheur", "chien", "Paris"], c: 1, exp: "'Bonheur' est un nom abstrait (sentiment)."},
                {q: "'Professeur' désigne :", opts: ["un lieu", "une personne", "une chose", "une action"], c: 1, exp: "'Professeur' désigne une personne/profession."},
                {q: "Le nom propre dans 'L'Algérie est belle' est :", opts: ["pays", "belle", "Algérie", "est"], c: 2, exp: "'Algérie' est un nom propre de pays."},
                {q: "Quel nom est féminin ?", opts: ["garçon", "fleur", "livre", "stylo"], c: 1, exp: "'Fleur' est féminin (une fleur)."},
                {q: "Le pluriel de 'cheval' :", opts: ["chevals", "chevaux", "chevaus", "chevales"], c: 1, exp: "Pluriel irrégulier : chevaux."},
                {q: "Quel mot n'est PAS un nom ?", opts: ["courage", "rapidement", "soleil", "enfance"], c: 1, exp: "'Rapidement' est un adverbe."},
                {q: "Dans 'Le livre de Sophie', qui possède ?", opts: ["livre", "de", "Sophie", "Le"], c: 2, exp: "'Sophie' indique la possession."},
                {q: "Un nom collectif désigne :", opts: ["une chose", "un groupe", "une action", "une qualité"], c: 1, exp: "Un collectif = groupe (foule, équipe)."},
                {q: "Féminin de 'directeur' :", opts: ["directeure", "directrice", "directeuse", "directeuresse"], c: 1, exp: "Le féminin est 'directrice'."},
                {q: "'Soleil' est un nom :", opts: ["propre", "commun", "abstrait", "collectif"], c: 1, exp: "'Soleil' est un nom commun."},
                {q: "Dans 'Trois pommes', 'pommes' est :", opts: ["verbe", "nom pluriel", "adjectif", "nom singulier"], c: 1, exp: "'Pommes' est au pluriel (-s)."},
                {q: "'Amitié' exprime :", opts: ["objet", "sentiment", "lieu", "personne"], c: 1, exp: "'Amitié' est un nom abstrait (sentiment)."}
            ],
            verbes: Array(15).fill({q: "Question sur les verbes", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication verbe"}),
            adjectifs: Array(15).fill({q: "Question sur les adjectifs", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication adjectif"}),
            determinants: Array(15).fill({q: "Question sur les déterminants", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication déterminant"}),
            prepositions: Array(15).fill({q: "Question sur les prépositions", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication préposition"}),
            pronoms: Array(15).fill({q: "Question sur les pronoms", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication pronom"}),
            conjugaison: Array(15).fill({q: "Question sur la conjugaison", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication conjugaison"}),
            phrases: Array(15).fill({q: "Question sur les phrases", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication phrase"}),
            orthographe: Array(15).fill({q: "Question sur l'orthographe", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication orthographe"}),
            temps: Array(15).fill({q: "Question sur les temps", opts: ["A", "B", "C", "D"], c: 0, exp: "Explication temps"})
        };

        let stats = {total: 0, correct: 0, streak: 0, weaknesses: {}, completed: {}};
        let currentLesson = null, currentQ = 0, sessionQs = [], sessionStats = {};

        function init() {
            const saved = localStorage.getItem('francaisIA_stats');
            if (saved) stats = JSON.parse(saved);
            updateDashboard();
            renderLessons();
            updateRecommendations();
        }

        function updateDashboard() {
            document.getElementById('totalQuestions').textContent = stats.total;
            document.getElementById('correctAnswers').textContent = stats.correct;
            document.getElementById('accuracyRate').textContent = stats.total > 0 ? Math.round(stats.correct/stats.total*100) + '%' : '0%';
            document.getElementById('streak').textContent = stats.streak;
            const level = Math.floor(stats.total / 50);
            const progress = (stats.total % 50) * 2;
            document.getElementById('levelProgress').style.width = progress + '%';
            document.getElementById('levelProgress').textContent = progress + '%';
            const badge = document.getElementById('levelBadge');
            if (level >= 5) { badge.textContent = 'Avancé'; badge.className = 'level-badge avance'; }
            else if (level >= 2) { badge.textContent = 'Intermédiaire'; badge.className = 'level-badge intermediaire'; }
            else { badge.textContent = 'Débutant'; badge.className = 'level-badge debutant'; }
        }

        function updateRecommendations() {
            const container = document.getElementById('aiSuggestions');
            let html = '';

            const weakTopics = Object.entries(stats.weaknesses).sort((a, b) => b[1] - a[1])[0];
            if (weakTopics) {
                const topic = lessons.find(l => l.id === weakTopics[0]);
                if (topic) {
                    html += `<div class="recommendation-item">
                        <strong>🎯 Amélioration recommandée</strong>
                        <p>Nous avons détecté des difficultés avec <strong>${topic.title}</strong>. Pratiquez davantage ce module pour progresser.</p>
                    </div>`;
                }
            }

            if (stats.streak >= 5) {
                html += `<div class="recommendation-item">
                    <strong>🔥 Série impressionnante !</strong>
                    <p>Bravo ! ${stats.streak} bonnes réponses consécutives. Continuez sur cette lancée !</p>
                </div>`;
            }

            if (html === '') {
                html = `<div class="recommendation-item">
                    <strong>🎯 Commencez votre parcours</strong>
                    <p>Sélectionnez un module ci-dessous pour débuter. Nous recommandons de commencer par <strong>Les Noms</strong>.</p>
                </div>`;
            }

            container.innerHTML = html;
        }

        function renderLessons() {
            const grid = document.getElementById('lessonsGrid');
            grid.innerHTML = lessons.map(l => {
                const completed = stats.completed[l.id] || 0;
                const progress = Math.round((completed / 15) * 100);
                return `
                <div class="lesson-card" data-difficulty="${l.difficulty}" onclick="startLesson('${l.id}')">
                    <div class="lesson-icon">${l.icon}</div>
                    <div class="lesson-title">${l.title}</div>
                    <div class="lesson-description">${l.desc}</div>
                    <div class="lesson-stats">
                        <span class="lesson-difficulty difficulty-${l.difficulty}">${l.difficulty.charAt(0).toUpperCase() + l.difficulty.slice(1)}</span>
                        <span style="color: #64748b; font-weight: 600; font-size: 0.9em;">${progress}%</span>
                    </div>
                </div>`;
            }).join('');
        }

        function filterLessons(filter) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.lesson-card').forEach(card => {
                card.style.display = (filter === 'tous' || card.dataset.difficulty === filter) ? 'block' : 'none';
            });
        }

        function startLesson(id) {
            currentLesson = id;
            currentQ = 0;
            sessionQs = [...questions[id]].sort(() => Math.random() - 0.5);
            sessionStats = {correct: 0, wrong: 0};
            document.getElementById('mainDashboard').style.display = 'none';
            document.getElementById('lessonContainer').classList.add('active');
            document.getElementById('currentLessonTitle').textContent = lessons.find(l => l.id === id).title;
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQ >= sessionQs.length) { showReport(); return; }
            const q = sessionQs[currentQ];
            document.getElementById('lessonProgressText').textContent = `Question ${currentQ + 1}/15`;
            document.getElementById('questionArea').innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number">${currentQ + 1}</div>
                        <div class="question-text"><h3>${q.q}</h3></div>
                    </div>
                    <div class="options-grid">
                        ${q.opts.map((o, i) => `<div class="option" onclick="checkAnswer(${i}, ${q.c})">${String.fromCharCode(65+i)}. ${o}</div>`).join('')}
                    </div>
                    <div class="explanation-box" id="exp">
                        <h4>💡 Explication</h4>
                        <p>${q.exp}</p>
                    </div>
                </div>
            `;
            document.getElementById('nextBtn').style.display = 'none';
        }

        function checkAnswer(sel, cor) {
            const opts = document.querySelectorAll('.option');
            opts.forEach(o => o.style.pointerEvents = 'none');
            stats.total++;
            if (sel === cor) {
                opts[sel].classList.add('correct');
                stats.correct++;
                stats.streak++;
                sessionStats.correct++;
            } else {
                opts[sel].classList.add('wrong');
                opts[cor].classList.add('correct');
                stats.streak = 0;
                sessionStats.wrong++;
                stats.weaknesses[currentLesson] = (stats.weaknesses[currentLesson] || 0) + 1;
            }
            document.getElementById('exp').classList.add('show');
            document.getElementById('nextBtn').style.display = 'block';
            updateDashboard();
            localStorage.setItem('francaisIA_stats', JSON.stringify(stats));
        }

        function nextQuestion() {
            currentQ++;
            loadQuestion();
        }

        function showReport() {
            const total = sessionStats.correct + sessionStats.wrong;
            const pct = Math.round(sessionStats.correct / total * 100);
            let msg = pct >= 90 ? '🏆 Excellent !' : pct >= 70 ? '⭐ Très bien !' : pct >= 50 ? '👍 Bien !' : '📚 À améliorer';
            stats.completed[currentLesson] = (stats.completed[currentLesson] || 0) + sessionStats.correct;
            localStorage.setItem('francaisIA_stats', JSON.stringify(stats));
            document.getElementById('questionArea').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('performanceReport').innerHTML = `
                <h2>${msg}</h2>
                <h3>Score: ${sessionStats.correct}/${total} (${pct}%)</h3>
                <button class="btn" onclick="startLesson('${currentLesson}')" style="margin: 10px;">🔄 Recommencer</button>
                <button class="btn" onclick="exitLesson()" style="background: linear-gradient(135deg, #10b981, #34d399); margin: 10px;">🏠 Retour</button>
            `;
            document.getElementById('performanceReport').classList.add('show');
        }

        function exitLesson() {
            document.getElementById('lessonContainer').classList.remove('active');
            document.getElementById('mainDashboard').style.display = 'block';
            document.getElementById('questionArea').style.display = 'block';
            document.getElementById('performanceReport').classList.remove('show');
            updateDashboard();
            updateRecommendations();
            renderLessons();
        }

        function showHelp() { document.getElementById('helpModal').classList.add('show'); }
        function closeHelp() { document.getElementById('helpModal').classList.remove('show'); }

        function exportData() {
            const data = {
                date_export: new Date().toISOString(),
                plateforme: 'FrançaisIA',
                statistiques: stats,
                modules_disponibles: lessons.length,
                total_questions: 150
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'francaisia_donnees_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetData() {
            if (confirm('Voulez-vous vraiment réinitialiser toutes vos données ?')) {
                localStorage.removeItem('francaisIA_stats');
                stats = {total: 0, correct: 0, streak: 0, weaknesses: {}, completed: {}};
                updateDashboard();
                updateRecommendations();
                renderLessons();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
